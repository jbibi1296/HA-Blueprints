blueprint:
  name: AC Thermostat with Day/Night Modes
  description: Automatically controls an AC unit based on a temperature sensor, with separate day and night schedules that correctly handle midnight crossovers.
  domain: automation
  source_url: https://gist.github.com/yourusername/somehash

  input:
    temperature_sensor:
      name: Temperature Sensor
      description: The temperature sensor entity to monitor.
      selector:
        entity:
          domain: sensor
          device_class: temperature
    
    ac_outlet:
      name: AC Outlet
      description: The outlet entity connected to the AC unit.
      selector:
        entity:
          domain: switch
          device_class: outlet

    # Day Schedule Inputs
    day_temperature_high:
      name: Day - Turn on temperature
      description: Temperature (in your system's unit) to turn on the AC during the day.
      default: 75
      selector:
        number:
          min: 60
          max: 90
          step: 1
          unit_of_measurement: "°F" # or °C
          mode: box
          
    day_temperature_low:
      name: Day - Turn off temperature
      description: Temperature (in your system's unit) to turn off the AC during the day.
      default: 72
      selector:
        number:
          min: 60
          max: 90
          step: 1
          unit_of_measurement: "°F" # or °C
          mode: box

    day_time_start:
      name: Day - Start Time
      description: The time of day to begin the day schedule.
      selector:
        time:

    day_time_end:
      name: Day - End Time
      description: The time of day to end the day schedule.
      selector:
        time:

    # Night Schedule Inputs
    night_temperature_high:
      name: Night - Turn on temperature
      description: Temperature (in your system's unit) to turn on the AC at night.
      default: 70
      selector:
        number:
          min: 60
          max: 90
          step: 1
          unit_of_measurement: "°F" # or °C
          mode: box
          
    night_temperature_low:
      name: Night - Turn off temperature
      description: Temperature (in your system's unit) to turn off the AC at night.
      default: 68
      selector:
        number:
          min: 60
          max: 90
          step: 1
          unit_of_measurement: "°F" # or °C
          mode: box

    night_time_start:
      name: Night - Start Time
      description: The time of day to begin the night schedule.
      selector:
        time:

    night_time_end:
      name: Night - End Time
      description: The time of day to end the night schedule.
      selector:
        time:
    
    # Days of the week input
    days_of_week:
      name: Days of the week
      description: The days to run the automation.
      selector:
        select:
          multiple: true
          options:
            - label: Monday
              value: mon
            - label: Tuesday
              value: tue
            - label: Wednesday
              value: wed
            - label: Thursday
              value: thu
            - label: Friday
              value: fri
            - label: Saturday
              value: sat
            - label: Sunday
              value: sun

variables:
  ac_outlet: !input ac_outlet
  temperature_sensor: !input temperature_sensor
  days_of_week: !input days_of_week
  day_time_start: !input day_time_start
  day_time_end: !input day_time_end
  night_time_start: !input night_time_start
  night_time_end: !input night_time_end
  day_temperature_high: !input day_temperature_high
  day_temperature_low: !input day_temperature_low
  night_temperature_high: !input night_temperature_high
  night_temperature_low: !input night_temperature_low

trigger:
  - platform: state
    entity_id: !input temperature_sensor

condition:
  - condition: time
    weekday: !input days_of_week

action:
  - choose:
      # Day schedule logic
      - conditions:
          - condition: time
            after: !input day_time_start
            before: !input day_time_end
        sequence:
          - choose:
              - conditions:
                  - condition: numeric_state
                    entity_id: !input temperature_sensor
                    above: !input day_temperature_high
                sequence:
                  - service: switch.turn_on
                    target:
                      entity_id: !input ac_outlet
              - conditions:
                  - condition: numeric_state
                    entity_id: !input temperature_sensor
                    below: !input day_temperature_low
                sequence:
                  - service: switch.turn_off
                    target:
                      entity_id: !input ac_outlet

      # Night schedule logic
      - conditions:
          - condition: template
            value_template: >
              {% set start_time = night_time_start.split(':') | map('int') | list %}
              {% set end_time = night_time_end.split(':') | map('int') | list %}
              {% set now = now().hour * 60 + now().minute %}
              {% set start = start_time[0] * 60 + start_time[1] %}
              {% set end = end_time[0] * 60 + end_time[1] %}
              
              {% if start < end %}
                {# Normal time range (e.g., 9pm to 11pm) #}
                {{ now > start and now < end }}
              {% else %}
                {# Midnight crossover (e.g., 10pm to 7am) #}
                {{ now > start or now < end }}
              {% endif %}
        sequence:
          - choose:
              - conditions:
                  - condition: numeric_state
                    entity_id: !input temperature_sensor
                    above: !input night_temperature_high
                sequence:
                  - service: switch.turn_on
                    target:
                      entity_id: !input ac_outlet
              - conditions:
                  - condition: numeric_state
                    entity_id: !input temperature_sensor
                    below: !input night_temperature_low
                sequence:
                  - service: switch.turn_off
                    target:
                      entity_id: !input ac_outlet
